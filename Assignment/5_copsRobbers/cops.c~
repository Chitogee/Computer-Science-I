#include <stdio.h>
#include <math.h>
#include <stdlib.h>
#include <string.h>
#include "cops.h"
#define PI 3.14159265358979323846



void readRobbers(Robber ** rob , int numRobbers){
  *rob = (Robber *) calloc((numRobbers+1),sizeof(Robber));

  int i = 0 ;
  int x, y , spd , dir ;
  x = 0 ;
  y = 0 ;
  spd = 0 ;
  dir = 0 ;
  for ( i = 0 ; i < numRobbers ; i++ ){
    scanf("%d %d %d %d",&x,&y,&dir,&spd);
    *(*rob+i) = initRobber(x,y,spd,dir);
  }
}
void readAndExecute(){
  Cop copper ;
  copper.x = 0 ;
  copper.y = 0 ;
  copper.time = 0.0  ;

  int numRobbers = 0 ;
  int i  ;

  scanf("%d %d",&numRobbers,&i);
  printf("%d %d\n",numRobbers, i);
  copper.speed = i ;

  Robber * rob ;
  readRobbers(&rob,numRobbers);
  double time ;


  for ( i = 0 ; i < numRobbers ; i++){
    time=getMinTime(copper,rob[i]) ;
    printf("Time: %f\n",time+copper.time);
    copper.time+=time ;
    copper.x = rob[i].x+rob[i].speed*(copper.time)*cos((rob[i].direction*2*PI)/360);
    copper.y = rob[i].y+rob[i].speed*(copper.time)*sin((rob[i].direction*2*PI)/360);
    printf("\nUpdated position: %f, %f\n",copper.x,copper.y);
    //printf("(%d) Robber: %d %d %d %d Time: %f\n",i,rob[i].x,rob[i].y,rob[i].speed,rob[i].direction,time);
  }
}

double getMinTime(Cop copper,Robber rob){
  float distChase =10;
  // use copper.time to figure robber pos.
  double time = 0.0;
  // while loop until copper.speed*t > distance
  printf("About to while\n");
  while (copper.speed*(time) < distChase){
    time+=0.0000001;
    double newX = rob.x+rob.speed*(copper.time+time)*cos((rob.direction*2*PI)/360)  ;
    double newY = rob.y+rob.speed*(copper.time+time)*sin((rob.direction*2*PI)/360)  ;
    distChase = pow((pow((newX-copper.x),2)+pow((newY-copper.y),2)),0.5);
  }
  printf("Dist %f Mintime:%f\n",distChase,time);
  return time ;
}

Robber initRobber(int x, int y, int speed, int direction){
  Robber rtn  ;
  rtn.x = (float)x ;
  rtn.y = (float)y ;
  rtn.speed = (float)speed ;
  rtn.direction = (float)direction ;
  return rtn  ;
}
